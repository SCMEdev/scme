
!==============================================================================================================
! Lorenzo Lodi, 29 May 2007
! This ais the CVR dipole-moment surface for water
! INPUT:  r1(bohrs), r2(bohrs), ctheta [ =cos(theta) ]
! OUTPUT: mu_z(a.u.), mu_x(a.u.)
! Atoms re in the (zy) plane, with the oxygen at the origin and the hydrogens in the first and fourth quadrants
! (see subroutines DIPSAL or DIPSRC for a diagram)
! In short: mu_z is the component along the bond-angle bisector, mu_x in perpendicular to the bond-angle bisector
! The routine DIPS is intended to be calles by the program DIPOLE3
subroutine DIPS(mu_z, mu_x, r1, r2, ctheta)
implicit none
double precision :: mu_z, mu_x, r1, r2, theta_in_degrees, ctheta, theta_in_radians, mu_x_CC, mu_z_CC, mu_x_RC, mu_z_RC

theta_in_radians = acos(ctheta)
theta_in_degrees = theta_in_radians*180.d0/acos(-1.d0)

call DIPS_valence_only(mu_z,mu_x,r1,r2,ctheta)      ! Main, valence-only surface
call DIPSAL(mu_z_CC,mu_x_CC,r1,r2,theta_in_radians) ! Core-correlation correction
call DIPSRC(mu_z_RC,mu_x_RC,r1,r2,theta_in_radians) ! Relativistic correction

mu_z = mu_z + mu_z_CC + mu_z_RC
mu_x = mu_x + mu_x_CC + mu_x_RC

end subroutine DIPS


!==============================================================================================================
! Lorenzo Lodi, 20 December 2005
! This is a VERY straightforward routine which calculates DMS(r1,r2,theta) of water 
!  from a function fit based of the model of Schwenke&Partrige 2000
subroutine DIPS_valence_only(mu_z, mu_x, r1, r2, ctheta) 
implicit none
double precision :: r1, r2, theta, ctheta, value1, value2, mu_x, mu_z, mu_x_CC, mu_z_CC, mu_x_RC, mu_z_RC
double precision, external :: q
 
 theta = acos(ctheta)
 value1 = r1 * q(r1, r2, theta)
 value2 = r2 * q(r2, r1, theta)
 mu_x = cos(theta/2.d0) * (value1 + value2)
 mu_z = sin(theta/2.d0) * (value1 - value2)

end subroutine DIPS_valence_only

!=============================================================================================
! It's the same function as in the article P&S2000
! NB: memory used to store the coefficients is 8*[(n_r+1) + (n_r+1)**2 * (n_theta+1)] bytes
! for n_r = n_theta = 20 it's about 73 KB ; reaches 1MB for n_r = n_theta = 50
double precision function q(r1,r2,theta)
implicit none
integer, parameter :: n_r_max = 20, n_theta_max = 20
double precision, parameter :: r_eq = 1.811583929628861d0, cos_theta_eq = -0.24780227221366477d0
integer i_loaded, i, j, k, n, n_r, n_theta
double precision :: c(0: n_r_max), d(0:n_r_max, 0:n_r_max, 0:n_theta_max), beta, &
                     r1, r2, theta,  &
                     x1, x2, x3, damp1, damp2, sum1, sum2, powers_x1(n_r_max), powers_x2(n_r_max), powers_x3(n_theta_max)
save c, d, n_r, n_theta, beta ! explicitly say that c(i) and d(i,j,k) should not be altered between successive calls to the function
data i_loaded / 0 /


if(i_loaded == 0) then ! it's the first run, load the parameters into memory from the file
   call get_coefficients(n_r_max, n_theta_max, n_r, n_theta, c, d, beta)
   i_loaded = 1
endif

damp1 = exp( -beta * ((r1-r_eq)**2) )
damp2 = exp( -beta * ((r2-r_eq)**2) )

x1 = (r1 - r_eq) / r_eq
x2 = (r2 - r_eq) / r_eq
x3 = ( cos(theta) - cos_theta_eq )

! Let's build tables of the powers of x1, x2, x3
do n = 0, n_r
   powers_x1(n) = x1**n
   powers_x2(n) = x2**n
end do

do n = 0, n_theta
   powers_x3(n) = x3**n
end do

!Let's compute the sums
sum1 = 0.d0 
do n=0, n_r
   sum1 = sum1 + c(n) * powers_x1(n)
enddo

sum2 = 0.d0 
do i = 0, n_r
   do j = 0, n_r
      do k = 0, n_theta
         sum2 = sum2 + d(i, j, k) * x1**i * x2**j * x3**k
      enddo
    enddo
enddo

q = damp1 * ( sum1 + damp2 * sum2)

end function q
!==========================================================================
subroutine get_coefficients(n_r_max, n_theta_max, n_r, n_theta, c, d, beta)
implicit none
integer :: n_r, n_theta, i, j, k, n, n_r_max, n_theta_max
double precision :: c(0: n_r_max), d(0:n_r_max, 0:n_r_max, 0:n_theta_max), beta, tmp

n_r     =  8 
n_theta = 18
beta    =  0.420042841

c = 0.d0 ; d = 0.d0

c( 0) =    0.330982017
c( 1) =   -0.188862651
c( 2) =    0.559028636
c( 3) =   -0.541448817
c( 4) =    0.712225306
c( 5) =   -0.934424699
c( 6) =    0.832524012
c( 7) =   -0.469531265
c( 8) =    0.112487747
d( 0, 0,  1) =      -0.064848397
d( 0, 0,  2) =       0.040565353
d( 0, 0,  3) =      -0.020333498
d( 0, 0,  4) =       0.006391579
d( 0, 0,  5) =       0.002955377
d( 0, 0,  6) =       0.196394080
d( 0, 0,  7) =      -0.399286547
d( 0, 0,  8) =      -1.340154485
d( 0, 0,  9) =       3.201909952
d( 0, 0, 10) =       4.396066333
d( 0, 0, 11) =     -12.533070350
d( 0, 0, 12) =      -6.159974243
d( 0, 0, 13) =      25.832262380
d( 0, 0, 14) =       0.187435053
d( 0, 0, 15) =     -27.166295680
d( 0, 0, 16) =       8.095598538
d( 0, 0, 17) =      11.495810890
d( 0, 0, 18) =      -5.814348531
d( 0, 1,  0) =      -0.061598049
d( 0, 1,  1) =       0.156616598
d( 0, 1,  2) =      -0.048356902
d( 0, 1,  3) =       0.016241940
d( 0, 1,  4) =       0.218951685
d( 0, 1,  5) =       0.157950303
d( 0, 1,  6) =      -2.100237557
d( 0, 1,  7) =       0.057638127
d( 0, 1,  8) =       8.849955601
d( 0, 1,  9) =      -3.104417846
d( 0, 1, 10) =     -19.477459980
d( 0, 1, 11) =       9.800414561
d( 0, 1, 12) =      23.032085130
d( 0, 1, 13) =     -13.032305940
d( 0, 1, 14) =     -13.872257900
d( 0, 1, 15) =       7.781476206
d( 0, 1, 16) =       3.396867997
d( 0, 1, 17) =      -1.705859172
d( 0, 2,  0) =       0.038678359
d( 0, 2,  1) =      -0.075139621
d( 0, 2,  2) =       0.097830408
d( 0, 2,  3) =      -0.070015313
d( 0, 2,  4) =      -1.850489245
d( 0, 2,  5) =       3.504713382
d( 0, 2,  6) =      11.744794160
d( 0, 2,  7) =     -25.548114780
d( 0, 2,  8) =     -32.305297620
d( 0, 2,  9) =      85.127385040
d( 0, 2, 10) =      32.570070680
d( 0, 2, 11) =    -154.010590900
d( 0, 2, 12) =      22.613032010
d( 0, 2, 13) =     153.847294500
d( 0, 2, 14) =     -76.762837700
d( 0, 2, 15) =     -67.597138200
d( 0, 2, 16) =      48.634532370
d( 0, 3,  0) =      -0.090103766
d( 0, 3,  1) =       0.085105043
d( 0, 3,  2) =       0.240306413
d( 0, 3,  3) =       2.205901832
d( 0, 3,  4) =      -9.383261755
d( 0, 3,  5) =     -16.698835160
d( 0, 3,  6) =      81.652531810
d( 0, 3,  7) =      28.146159860
d( 0, 3,  8) =    -295.356609700
d( 0, 3,  9) =     102.236754100
d( 0, 3, 10) =     489.170279300
d( 0, 3, 11) =    -381.178897800
d( 0, 3, 12) =    -356.663879200
d( 0, 3, 13) =     405.370373600
d( 0, 3, 14) =      87.825462990
d( 0, 3, 15) =    -137.525351800
d( 0, 4,  0) =       0.111061016
d( 0, 4,  1) =       0.159623381
d( 0, 4,  2) =      -2.942444181
d( 0, 4,  3) =      -0.705350044
d( 0, 4,  4) =      60.968624550
d( 0, 4,  5) =     -72.402030200
d( 0, 4,  6) =    -371.223247700
d( 0, 4,  7) =     611.693246100
d( 0, 4,  8) =     871.579810800
d( 0, 4,  9) =   -1777.102391000
d( 0, 4, 10) =    -698.340919200
d( 0, 4, 11) =    2118.847688000
d( 0, 4, 12) =    -128.713301100
d( 0, 4, 13) =    -861.206900000
d( 0, 4, 14) =     250.776967900
d( 0, 5,  0) =      -0.192080672
d( 0, 5,  1) =       0.842331516
d( 0, 5,  2) =       2.469292036
d( 0, 5,  3) =     -42.123219400
d( 0, 5,  4) =      -6.512209051
d( 0, 5,  5) =     570.209714300
d( 0, 5,  6) =    -296.150250200
d( 0, 5,  7) =   -2579.750107000
d( 0, 5,  8) =    1718.012225000
d( 0, 5,  9) =    4735.134752000
d( 0, 5, 10) =   -3119.797789000
d( 0, 5, 11) =   -3350.083827000
d( 0, 5, 12) =    1761.099831000
d( 0, 5, 13) =     605.569095500
d( 0, 6,  0) =       0.189424028
d( 0, 6,  1) =      -4.974831589
d( 0, 6,  2) =      13.679350770
d( 0, 6,  3) =     151.691797100
d( 0, 6,  4) =    -402.214199700
d( 0, 6,  5) =   -1210.010790000
d( 0, 6,  6) =    3136.367117000
d( 0, 6,  7) =    3198.585138000
d( 0, 6,  8) =   -8904.821791000
d( 0, 6,  9) =   -2526.038092000
d( 0, 6, 10) =    9651.874538000
d( 0, 6, 11) =    -234.375959600
d( 0, 6, 12) =   -2880.576316000
d( 0, 7,  0) =      -0.022592065
d( 0, 7,  1) =       9.180045278
d( 0, 7,  2) =     -26.429862740
d( 0, 7,  3) =    -223.845799200
d( 0, 7,  4) =     672.248393800
d( 0, 7,  5) =    1145.244271000
d( 0, 7,  6) =   -4309.202766000
d( 0, 7,  7) =    -715.122484500
d( 0, 7,  8) =    9262.311426000
d( 0, 7,  9) =   -3672.457615000
d( 0, 7, 10) =   -6096.449944000
d( 0, 7, 11) =    3982.029049000
d( 0, 8,  0) =       0.004461562
d( 0, 8,  1) =      -6.070562636
d( 0, 8,  2) =      11.888150140
d( 0, 8,  3) =     132.692366100
d( 0, 8,  4) =    -297.297977000
d( 0, 8,  5) =    -557.411679900
d( 0, 8,  6) =    1574.845237000
d( 0, 8,  7) =      88.863959930
d( 0, 8,  8) =   -2036.550114000
d( 0, 8,  9) =    1263.962816000
d( 0, 8, 10) =    -193.262787100
d( 1, 0,  1) =      -0.071933240
d( 1, 0,  2) =      -0.034002172
d( 1, 0,  3) =      -0.056737602
d( 1, 0,  4) =       0.084996242
d( 1, 0,  5) =      -0.190750932
d( 1, 0,  6) =      -0.514424891
d( 1, 0,  7) =       1.392746915
d( 1, 0,  8) =       2.234998717
d( 1, 0,  9) =      -5.558285047
d( 1, 0, 10) =      -3.762906206
d( 1, 0, 11) =       9.658736253
d( 1, 0, 12) =       3.294387619
d( 1, 0, 13) =      -7.082198572
d( 1, 0, 14) =      -3.150611854
d( 1, 0, 15) =       2.219297889
d( 1, 0, 16) =       2.805520949
d( 1, 0, 17) =      -1.404229230
d( 1, 1,  0) =      -0.055939278
d( 1, 1,  1) =       0.007016842
d( 1, 1,  2) =       0.045766395
d( 1, 1,  3) =       0.135875238
d( 1, 1,  4) =      -2.768600854
d( 1, 1,  5) =      -0.167381823
d( 1, 1,  6) =      17.018909070
d( 1, 1,  7) =       6.835206491
d( 1, 1,  8) =     -51.749893360
d( 1, 1,  9) =     -54.898599430
d( 1, 1, 10) =      90.837356530
d( 1, 1, 11) =     172.679905400
d( 1, 1, 12) =    -124.045830600
d( 1, 1, 13) =    -242.456924300
d( 1, 1, 14) =     142.595498500
d( 1, 1, 15) =     127.825546200
d( 1, 1, 16) =     -82.219832690
d( 1, 2,  0) =       0.056580952
d( 1, 2,  1) =      -0.204547234
d( 1, 2,  2) =      -0.233901084
d( 1, 2,  3) =       5.824630650
d( 1, 2,  4) =      -2.366894442
d( 1, 2,  5) =     -51.042823480
d( 1, 2,  6) =      14.252783260
d( 1, 2,  7) =     199.322701200
d( 1, 2,  8) =       6.562188863
d( 1, 2,  9) =    -405.914793700
d( 1, 2, 10) =    -181.858345400
d( 1, 2, 11) =     502.050734300
d( 1, 2, 12) =     372.041124000
d( 1, 2, 13) =    -430.476134800
d( 1, 2, 14) =    -223.086511000
d( 1, 2, 15) =     194.885698200
d( 1, 3,  0) =      -0.013427633
d( 1, 3,  1) =       0.217405945
d( 1, 3,  2) =      -5.437081026
d( 1, 3,  3) =       0.092328067
d( 1, 3,  4) =      82.211488490
d( 1, 3,  5) =     -40.255893350
d( 1, 3,  6) =    -410.113054900
d( 1, 3,  7) =     198.872296700
d( 1, 3,  8) =     888.305587900
d( 1, 3,  9) =    -244.431208800
d( 1, 3, 10) =    -950.679429400
d( 1, 3, 11) =    -111.901025800
d( 1, 3, 12) =     613.040379700
d( 1, 3, 13) =     251.285042300
d( 1, 3, 14) =    -269.818446500
d( 1, 4,  0) =      -0.305219681
d( 1, 4,  1) =       4.240348244
d( 1, 4,  2) =       4.484751537
d( 1, 4,  3) =    -140.045056300
d( 1, 4,  4) =     108.272509100
d( 1, 4,  5) =    1113.135600000
d( 1, 4,  6) =   -1128.587364000
d( 1, 4,  7) =   -3582.941783000
d( 1, 4,  8) =    3709.998728000
d( 1, 4,  9) =    4822.818711000
d( 1, 4, 10) =   -4812.806261000
d( 1, 4, 11) =   -2170.753097000
d( 1, 4, 12) =    1911.377359000
d( 1, 4, 13) =     150.322075700
d( 1, 5,  0) =       0.804050640
d( 1, 5,  1) =     -19.348698900
d( 1, 5,  2) =      75.878912370
d( 1, 5,  3) =     410.804000500
d( 1, 5,  4) =   -1730.841035000
d( 1, 5,  5) =   -1866.175266000
d( 1, 5,  6) =    9557.447490000
d( 1, 5,  7) =    2400.149862000
d( 1, 5,  8) =  -20716.140410000
d( 1, 5,  9) =    1470.077261000
d( 1, 5, 10) =   17595.652290000
d( 1, 5, 11) =   -3561.336565000
d( 1, 5, 12) =   -3604.878343000
d( 1, 6,  0) =      -1.547990684
d( 1, 6,  1) =      35.216721160
d( 1, 6,  2) =    -194.413542200
d( 1, 6,  3) =    -441.556837400
d( 1, 6,  4) =    3578.641599000
d( 1, 6,  5) =    -328.601682400
d( 1, 6,  6) =  -16274.553840000
d( 1, 6,  7) =    9712.888465000
d( 1, 6,  8) =   26452.163260000
d( 1, 6,  9) =  -20974.998260000
d( 1, 6, 10) =  -12971.636450000
d( 1, 6, 11) =   11428.989090000
d( 1, 7,  0) =       1.392826654
d( 1, 7,  1) =     -23.202970510
d( 1, 7,  2) =     124.722870800
d( 1, 7,  3) =     152.874057900
d( 1, 7,  4) =   -2014.593625000
d( 1, 7,  5) =    1584.045690000
d( 1, 7,  6) =    6841.456051000
d( 1, 7,  7) =   -9883.632762000
d( 1, 7,  8) =   -4167.752817000
d( 1, 7,  9) =   12860.029290000
d( 1, 7, 10) =   -5508.937020000
d( 2, 0,  1) =      -0.055766301
d( 2, 0,  2) =       0.184377492
d( 2, 0,  3) =      -0.156339096
d( 2, 0,  4) =      -1.816522554
d( 2, 0,  5) =       2.703128159
d( 2, 0,  6) =      14.612800870
d( 2, 0,  7) =     -20.532392960
d( 2, 0,  8) =     -53.050622130
d( 2, 0,  9) =      76.094829670
d( 2, 0, 10) =      98.567829710
d( 2, 0, 11) =    -163.727788700
d( 2, 0, 12) =     -71.360322520
d( 2, 0, 13) =     192.045879100
d( 2, 0, 14) =     -23.717564380
d( 2, 0, 15) =     -94.037551410
d( 2, 0, 16) =      44.470264760
d( 2, 1,  0) =      -0.101946423
d( 2, 1,  1) =       0.054329000
d( 2, 1,  2) =      -0.117507972
d( 2, 1,  3) =       6.374919989
d( 2, 1,  4) =      -3.014648749
d( 2, 1,  5) =     -53.084459780
d( 2, 1,  6) =      27.775276770
d( 2, 1,  7) =     206.287650600
d( 2, 1,  8) =     -74.306923950
d( 2, 1,  9) =    -393.950845300
d( 2, 1, 10) =      31.988953340
d( 2, 1, 11) =     404.338753700
d( 2, 1, 12) =     111.412746100
d( 2, 1, 13) =    -257.275716200
d( 2, 1, 14) =    -100.492307800
d( 2, 1, 15) =      94.842643360
d( 2, 2,  0) =       0.127990592
d( 2, 2,  1) =       0.041500493
d( 2, 2,  2) =      -6.262250106
d( 2, 2,  3) =       4.319071193
d( 2, 2,  4) =     108.437898500
d( 2, 2,  5) =    -116.930936000
d( 2, 2,  6) =    -603.698015900
d( 2, 2,  7) =     587.051367900
d( 2, 2,  8) =    1581.674080000
d( 2, 2,  9) =   -1111.565177000
d( 2, 2, 10) =   -2243.928905000
d( 2, 2, 11) =     871.991652300
d( 2, 2, 12) =    1707.254426000
d( 2, 2, 13) =    -242.818949700
d( 2, 2, 14) =    -536.428342300
d( 2, 3,  0) =      -0.615047223
d( 2, 3,  1) =       3.556562534
d( 2, 3,  2) =      14.964624060
d( 2, 3,  3) =    -112.478055100
d( 2, 3,  4) =    -122.601541700
d( 2, 3,  5) =    1170.442487000
d( 2, 3,  6) =      70.713463780
d( 2, 3,  7) =   -4724.669893000
d( 2, 3,  8) =     887.199719100
d( 2, 3,  9) =    8346.667348000
d( 2, 3, 10) =   -1235.324301000
d( 2, 3, 11) =   -6811.992389000
d( 2, 3, 12) =     -67.612703020
d( 2, 3, 13) =    2587.785869000
d( 2, 4,  0) =      -0.168960255
d( 2, 4,  1) =      -6.098420443
d( 2, 4,  2) =      83.285325510
d( 2, 4,  3) =      92.918166480
d( 2, 4,  4) =   -1451.603994000
d( 2, 4,  5) =    -107.294859100
d( 2, 4,  6) =    7621.443178000
d( 2, 4,  7) =    -707.627472000
d( 2, 4,  8) =  -16114.078880000
d( 2, 4,  9) =    1929.328356000
d( 2, 4, 10) =   14046.031530000
d( 2, 4, 11) =   -1553.022837000
d( 2, 4, 12) =   -3817.267066000
d( 2, 5,  0) =       4.152567645
d( 2, 5,  1) =      -8.390050198
d( 2, 5,  2) =    -288.210737800
d( 2, 5,  3) =     442.053958900
d( 2, 5,  4) =    3826.291306000
d( 2, 5,  5) =   -6184.607939000
d( 2, 5,  6) =  -13651.093940000
d( 2, 5,  7) =   22343.565450000
d( 2, 5,  8) =   14025.475110000
d( 2, 5,  9) =  -25654.402320000
d( 2, 5, 10) =    -435.877328900
d( 2, 5, 11) =    5508.423780000
d( 2, 6,  0) =      -4.704270004
d( 2, 6,  1) =      17.284952150
d( 2, 6,  2) =     239.611206000
d( 2, 6,  3) =    -628.337121400
d( 2, 6,  4) =   -2788.170893000
d( 2, 6,  5) =    7423.327594000
d( 2, 6,  6) =    7245.880775000
d( 2, 6,  7) =  -24024.609100000
d( 2, 6,  8) =     724.383822100
d( 2, 6,  9) =   22405.166170000
d( 2, 6, 10) =  -10553.783240000
d( 3, 0,  1) =       0.053883259
d( 3, 0,  2) =      -0.330545696
d( 3, 0,  3) =       1.039149277
d( 3, 0,  4) =      -0.773611856
d( 3, 0,  5) =      -7.376727631
d( 3, 0,  6) =      17.646521770
d( 3, 0,  7) =       0.105748585
d( 3, 0,  8) =     -77.408737980
d( 3, 0,  9) =     119.030261200
d( 3, 0, 10) =     107.558071000
d( 3, 0, 11) =    -324.718125900
d( 3, 0, 12) =      -0.601240328
d( 3, 0, 13) =     282.812833100
d( 3, 0, 14) =     -60.170486650
d( 3, 0, 15) =     -56.967549800
d( 3, 1,  0) =       0.054385177
d( 3, 1,  1) =      -0.113391050
d( 3, 1,  2) =      -5.474254751
d( 3, 1,  3) =       1.853940371
d( 3, 1,  4) =      93.670183710
d( 3, 1,  5) =     -72.258299460
d( 3, 1,  6) =    -549.517271600
d( 3, 1,  7) =     451.069694100
d( 3, 1,  8) =    1375.813969000
d( 3, 1,  9) =   -1088.588547000
d( 3, 1, 10) =   -1547.922694000
d( 3, 1, 11) =    1142.338514000
d( 3, 1, 12) =     653.935634200
d( 3, 1, 13) =    -436.325226000
d( 3, 1, 14) =     -14.241137570
d( 3, 2,  0) =      -0.433761998
d( 3, 2,  1) =       4.331316946
d( 3, 2,  2) =      11.059352730
d( 3, 2,  3) =    -127.513890900
d( 3, 2,  4) =     -58.108984670
d( 3, 2,  5) =    1278.571253000
d( 3, 2,  6) =    -246.665913900
d( 3, 2,  7) =   -4986.945646000
d( 3, 2,  8) =    1715.485161000
d( 3, 2,  9) =    8332.320787000
d( 3, 2, 10) =   -2580.830070000
d( 3, 2, 11) =   -5913.617656000
d( 3, 2, 12) =     906.925640300
d( 3, 2, 13) =    1656.783299000
d( 3, 3,  0) =      -1.334570976
d( 3, 3,  1) =       5.605018852
d( 3, 3,  2) =      83.304722990
d( 3, 3,  3) =    -148.520988800
d( 3, 3,  4) =   -1200.856518000
d( 3, 3,  5) =    1016.005807000
d( 3, 3,  6) =    6916.959065000
d( 3, 3,  7) =   -1637.795150000
d( 3, 3,  8) =  -17166.478950000
d( 3, 3,  9) =   -1101.659431000
d( 3, 3, 10) =   19580.253200000
d( 3, 3, 11) =    2964.301930000
d( 3, 3, 12) =   -9363.173922000
d( 3, 4,  0) =       6.444660069
d( 3, 4,  1) =     -44.167909820
d( 3, 4,  2) =    -329.453394600
d( 3, 4,  3) =    1461.632897000
d( 3, 4,  4) =    3519.307445000
d( 3, 4,  5) =  -13091.779370000
d( 3, 4,  6) =  -12535.286970000
d( 3, 4,  7) =   42105.729760000
d( 3, 4,  8) =   13232.756330000
d( 3, 4,  9) =  -50551.856350000
d( 3, 4, 10) =     391.424847700
d( 3, 4, 11) =   15935.391010000
d( 3, 5,  0) =      -4.698394214
d( 3, 5,  1) =      24.198762550
d( 3, 5,  2) =     320.736825300
d( 3, 5,  3) =   -1108.226802000
d( 3, 5,  4) =   -3212.830320000
d( 3, 5,  5) =   10299.919500000
d( 3, 5,  6) =    7653.732670000
d( 3, 5,  7) =  -31429.012460000
d( 3, 5,  8) =    2971.343688000
d( 3, 5,  9) =   29228.008330000
d( 3, 5, 10) =  -14726.337490000
d( 4, 0,  1) =      -0.078040174
d( 4, 0,  2) =      -1.449539233
d( 4, 0,  3) =       5.463032828
d( 4, 0,  4) =      28.195106600
d( 4, 0,  5) =     -89.929182290
d( 4, 0,  6) =    -153.390747100
d( 4, 0,  7) =     519.915961100
d( 4, 0,  8) =     286.291996600
d( 4, 0,  9) =   -1355.621636000
d( 4, 0, 10) =      -1.860347809
d( 4, 0, 11) =    1634.709656000
d( 4, 0, 12) =    -484.766380400
d( 4, 0, 13) =    -744.964122800
d( 4, 0, 14) =     352.738841600
d( 4, 1,  0) =      -0.458519502
d( 4, 1,  1) =       4.836738592
d( 4, 1,  2) =       5.857148992
d( 4, 1,  3) =    -133.298691300
d( 4, 1,  4) =      15.412119340
d( 4, 1,  5) =    1146.927161000
d( 4, 1,  6) =    -439.532488000
d( 4, 1,  7) =   -4095.741079000
d( 4, 1,  8) =    1981.425756000
d( 4, 1,  9) =    6499.010490000
d( 4, 1, 10) =   -3231.362287000
d( 4, 1, 11) =   -4126.838508000
d( 4, 1, 12) =    1614.004811000
d( 4, 1, 13) =     760.818126700
d( 4, 2,  0) =       0.639174962
d( 4, 2,  1) =     -11.926830840
d( 4, 2,  2) =      57.928782710
d( 4, 2,  3) =     183.256255100
d( 4, 2,  4) =   -1188.265409000
d( 4, 2,  5) =    -520.634472700
d( 4, 2,  6) =    6356.084088000
d( 4, 2,  7) =     112.633753700
d( 4, 2,  8) =  -13298.887680000
d( 4, 2,  9) =     902.053828600
d( 4, 2, 10) =   11409.424660000
d( 4, 2, 11) =    -839.035934400
d( 4, 2, 12) =   -3145.940840000
d( 4, 3,  0) =       5.076961823
d( 4, 3,  1) =     -26.594449820
d( 4, 3,  2) =    -320.160509600
d( 4, 3,  3) =    1076.893870000
d( 4, 3,  4) =    4018.913552000
d( 4, 3,  5) =  -11029.426590000
d( 4, 3,  6) =  -15474.448880000
d( 4, 3,  7) =   37771.848510000
d( 4, 3,  8) =   18161.803600000
d( 4, 3,  9) =  -46519.568850000
d( 4, 3, 10) =   -1998.166555000
d( 4, 3, 11) =   14347.774750000
d( 4, 4,  0) =     -10.011541120
d( 4, 4,  1) =      88.627611980
d( 4, 4,  2) =     298.804203100
d( 4, 4,  3) =   -2522.399610000
d( 4, 4,  4) =   -1973.464167000
d( 4, 4,  5) =   21630.243210000
d( 4, 4,  6) =    -512.547846400
d( 4, 4,  7) =  -65632.576830000
d( 4, 4,  8) =   27995.715900000
d( 4, 4,  9) =   64180.216090000
d( 4, 4, 10) =  -43718.472950000
d( 5, 0,  1) =       1.217270699
d( 5, 0,  2) =       3.514065672
d( 5, 0,  3) =     -36.251642990
d( 5, 0,  4) =     -35.613166300
d( 5, 0,  5) =     420.975031300
d( 5, 0,  6) =     -71.873211750
d( 5, 0,  7) =   -1801.383980000
d( 5, 0,  8) =    1001.585618000
d( 5, 0,  9) =    3163.223497000
d( 5, 0, 10) =   -2201.863290000
d( 5, 0, 11) =   -2009.958969000
d( 5, 0, 12) =    1411.760684000
d( 5, 0, 13) =     161.453406800
d( 5, 1,  0) =       0.723768478
d( 5, 1,  1) =     -14.988016030
d( 5, 1,  2) =      49.446711540
d( 5, 1,  3) =     357.576896000
d( 5, 1,  4) =   -1235.653728000
d( 5, 1,  5) =   -1966.463181000
d( 5, 1,  6) =    7152.332606000
d( 5, 1,  7) =    3723.519638000
d( 5, 1,  8) =  -16530.292520000
d( 5, 1,  9) =   -1433.630237000
d( 5, 1, 10) =   15464.787550000
d( 5, 1, 11) =   -1569.988243000
d( 5, 1, 12) =   -4042.031723000
d( 5, 2,  0) =       1.157189176
d( 5, 2,  1) =       2.229534989
d( 5, 2,  2) =    -164.850981800
d( 5, 2,  3) =     245.171207600
d( 5, 2,  4) =    2480.502364000
d( 5, 2,  5) =   -5335.455887000
d( 5, 2,  6) =   -8260.813084000
d( 5, 2,  7) =   21036.357060000
d( 5, 2,  8) =    5416.923662000
d( 5, 2,  9) =  -24498.903000000
d( 5, 2, 10) =    4336.301197000
d( 5, 2, 11) =    4817.529046000
d( 5, 3,  0) =      -2.469611470
d( 5, 3,  1) =       4.277734501
d( 5, 3,  2) =     265.948226500
d( 5, 3,  3) =    -634.759454400
d( 5, 3,  4) =   -3462.098901000
d( 5, 3,  5) =    8149.259986000
d( 5, 3,  6) =   10648.728930000
d( 5, 3,  7) =  -28050.068880000
d( 5, 3,  8) =   -3446.478941000
d( 5, 3,  9) =   27504.450710000
d( 5, 3, 10) =  -10819.877060000
d( 6, 0,  1) =      -1.983633106
d( 6, 0,  2) =       3.892848682
d( 6, 0,  3) =      47.139447240
d( 6, 0,  4) =    -131.265810000
d( 6, 0,  5) =    -437.801070700
d( 6, 0,  6) =    1278.544535000
d( 6, 0,  7) =    1518.009088000
d( 6, 0,  8) =   -4044.686009000
d( 6, 0,  9) =   -1901.090862000
d( 6, 0, 10) =    4686.454077000
d( 6, 0, 11) =     573.513860300
d( 6, 0, 12) =   -1541.620004000
d( 6, 1,  0) =      -0.364635500
d( 6, 1,  1) =      18.374019510
d( 6, 1,  2) =    -120.067746300
d( 6, 1,  3) =    -340.923084600
d( 6, 1,  4) =    2528.431041000
d( 6, 1,  5) =     303.002686300
d( 6, 1,  6) =  -12304.779420000
d( 6, 1,  7) =    5743.261048000
d( 6, 1,  8) =   21198.879510000
d( 6, 1,  9) =  -15008.195620000
d( 6, 1, 10) =  -11069.098160000
d( 6, 1, 11) =    9103.804117000
d( 6, 2,  0) =      -2.142080603
d( 6, 2,  1) =      12.393034990
d( 6, 2,  2) =     114.043264800
d( 6, 2,  3) =    -473.115031200
d( 6, 2,  4) =   -1356.968436000
d( 6, 2,  5) =    6388.865408000
d( 6, 2,  6) =    1501.798684000
d( 6, 2,  7) =  -21752.362800000
d( 6, 2,  8) =    9286.073172000
d( 6, 2,  9) =   20706.801420000
d( 6, 2, 10) =  -14601.899480000
d( 7, 0,  1) =       0.893910235
d( 7, 0,  2) =     -19.911972770
d( 7, 0,  3) =      10.524983760
d( 7, 0,  4) =     353.367778200
d( 7, 0,  5) =    -217.841379100
d( 7, 0,  6) =   -2255.488910000
d( 7, 0,  7) =    1186.376127000
d( 7, 0,  8) =    4857.885664000
d( 7, 0,  9) =   -2331.315498000
d( 7, 0, 10) =   -3030.699278000
d( 7, 0, 11) =    1295.075235000
d( 7, 1,  0) =       0.115575006
d( 7, 1,  1) =      -8.316704055
d( 7, 1,  2) =      73.070723960
d( 7, 1,  3) =      91.862198420
d( 7, 1,  4) =   -1417.379943000
d( 7, 1,  5) =     867.204659400
d( 7, 1,  6) =    5580.223383000
d( 7, 1,  7) =   -6308.438706000
d( 7, 1,  8) =   -4950.421368000
d( 7, 1,  9) =    8935.237100000
d( 7, 1, 10) =   -2852.938010000
d( 8, 0,  1) =       0.199631639
d( 8, 0,  2) =      15.175385480
d( 8, 0,  3) =     -28.091369810
d( 8, 0,  4) =    -232.830145400
d( 8, 0,  5) =     326.530166500
d( 8, 0,  6) =    1252.138639000
d( 8, 0,  7) =   -1259.053797000
d( 8, 0,  8) =   -2084.370624000
d( 8, 0,  9) =    1551.016753000
d( 8, 0, 10) =     576.065097800

end subroutine get_coefficients

!***********************************************************************
!****     SUBROUTINE DIPSRC  *******************************************
!***********************************************************************
!
!
         SUBROUTINE DIPSRC(DIPYRC,DIPZRC,R1,R2,THETA)
!
!
!     PURPOSE:
!     -------
!     Relativistic corrections are returned to components
!     (for specified water molecule geometries in the Y-Z plane) of the
!     water molecule dipole moment, based on a fit of the Schwenke &
!     Partridge (2000) functional form to ab-intio spin-orbit coupling
!     CCSD(T) calculations by Joost van Stralen.
!
!
!     NOTES:
!     -----
!     The oxygen atom is considered as fixed at the origin and the H1
!     atom lies in the positive Y-Z quadrant.  The cartesian coordinate
!     system is such that the Z-axis bisects the included bond angle for
!     any geometry.  This subroutine is intended to be called by the
!     DIPS routine in the triatom program suite of Tennyson et al.
!     (1993).
!
!                                ^  Y
!                                l        H1
!                                l
!                                l
!                - - - - - - - - O - - - - - - - - >  Z
!                                l
!                                l
!                                l         H2
!
!
!     REFERENCES:
!     ----------
!     Schwenke D.W. & Partridge H., 2000
!     Tennyson, J., Miller, S. & Le Sueur, C.R., 1993. Comput. Phys.
!       Comm. 75, 339.
!
!
!     DICTIONARY:
!     ----------
!D    A0BOHR              -  Bohr radius in Aangstroms.
!D    BAREFR              -  reference bond angle in radians.
!D    BLREFR              -  reference bond length in atomic units.
!D    DEBYES              -  number of Debyes in an atomic unit.
!D    DIPYRC              -  relativistic correction to dipole moment
!                            component orthogonal to bond bisector.
!D    DIPZRC              -  relativistic correction to dipole moment
!                            component along bond angle bisector.
!D    FCBETA              -  scaling for exponetials used in effective
!                            charge calculation.
!D    FPARAM(MPARAM)      -  fit parameters.
!I    IFIRST              -  flag signally first or later call of this
!                            routine.
!D    PRMnnn              -  parameter values as scalars.
!D    R1                  -  separation of oxygen and H1 atoms in Bohrs.
!D    R2                  -  separation of oxygen and H2 atoms in Bohrs.
!D    THETA               -  bond angle in radians.
!
!
!     DATE AND PROGRAMMER:
!     -------------------
!     A.E. Lynas-Gray                                     2003 March 7th
!
!
!-----------------------------------------------------------------------
!
!     IMPORT:  R1     , R2     , THETA
!     EXPORT:  DIPYRC , DIPZRC
!
!-----------------------------------------------------------------------
!
!
!
         IMPLICIT DOUBLE PRECISION (A-H,O-Z)
!
!
!
         PARAMETER  (A0BOHR = 0.52917706D0)
         PARAMETER  (BAREFR = 104.52D0*3.141592653589793/180.0D0)
         PARAMETER  (BLREFR = 0.957624684D0/A0BOHR)
         PARAMETER  (FCBETA = 3.8D-1*A0BOHR**2)
         PARAMETER  (DEBYES = 2.541747578)
         PARAMETER  (MPARAM = 84)
!
!
         DIMENSION  FPARAM(MPARAM)
!
!
         SAVE  IFIRST
         SAVE  PRM001 , PRM002 , PRM003 , PRM004 , PRM005 , PRM006
         SAVE  PRM007 , PRM008 , PRM009 , PRM010 , PRM011 , PRM012
         SAVE  PRM013 , PRM014 , PRM015 , PRM016 , PRM017 , PRM018
         SAVE  PRM019 , PRM020 , PRM021 , PRM022 , PRM023 , PRM024
         SAVE  PRM025 , PRM026 , PRM027 , PRM028 , PRM029 , PRM030
         SAVE  PRM031 , PRM032 , PRM033 , PRM034 , PRM035 , PRM036
         SAVE  PRM037 , PRM038 , PRM039 , PRM040 , PRM041 , PRM042
         SAVE  PRM043 , PRM044 , PRM045 , PRM046 , PRM047 , PRM048
         SAVE  PRM049 , PRM050 , PRM051 , PRM052 , PRM053 , PRM054
         SAVE  PRM055 , PRM056 , PRM057 , PRM058 , PRM059 , PRM060
         SAVE  PRM061 , PRM062 , PRM063 , PRM064 , PRM065 , PRM066
         SAVE  PRM067 , PRM068 , PRM069 , PRM070 , PRM071 , PRM072
         SAVE  PRM073 , PRM074 , PRM075 , PRM076 , PRM077 , PRM078
         SAVE  PRM079 , PRM080 , PRM081 , PRM082 , PRM083 , PRM084
!
!
         DATA       IFIRST / 0 /
!
!
         DATA (FPARAM(LPARAM),LPARAM=01,MPARAM) /&
            -7.70391431D-04 ,    -4.69740422D-04 ,     6.11087089D-05,&
             4.78438596D-04 ,    -1.12685202D-05 ,    -1.12065063D-04,&
             2.13152598D-05 ,     2.38666544D-04 ,    -1.42028177D-04,&
             2.15814616D-05 ,    -9.79817414D-05 ,     1.62372395D-04,&
            -5.71789205D-05 ,    -2.40074325D-04 ,     8.57470033D-04,&
            -2.04125972D-05 ,    -5.35663676D-05 ,    -2.47124489D-03,&
             2.81054573D-03 ,     1.58077106D-04 ,    -8.44667229D-05,&
            -1.03055337D-03 ,     2.48984690D-03 ,    -1.84013206D-03,&
             4.42688142D-05 ,    -9.19489772D-04 ,     1.21105427D-03,&
            -9.73901129D-04 ,     3.74132833D-05 ,    -3.08710238D-04,&
             1.01051046D-04 ,    -5.23007147D-05 ,     7.02070771D-04,&
             1.02900212D-05 ,     1.67727776D-05 ,    -7.98697816D-04,&
             1.31938688D-03 ,     8.52813944D-04 ,    -1.56458467D-03,&
             6.23775268D-05 ,     7.14333291D-05 ,    -2.67532712D-04,&
             3.46721557D-04 ,    -5.16566506D-04 ,     3.01089778D-04,&
            -1.02985813D-03 ,     1.36199791D-03 ,    -2.36280481D-04,&
             3.13943136D-04 ,    -8.77717248D-05 ,     6.70725945D-04,&
            -2.06068784D-04 ,    -5.33647544D-05 ,    -3.19712388D-04,&
             1.59858353D-03 ,    -5.50020544D-04 ,     3.63587344D-04,&
            -8.30255798D-04 ,     6.64299936D-04 ,    -1.03042321D-03,&
             3.16815305D-04 ,     6.53067313D-04 ,    -2.09874182D-04,&
            -2.80591310D-04 ,     1.78868664D-04 ,    -1.60483294D-04,&
            -5.27635966D-05 ,     2.56790168D-04 ,    -1.07000204D-04,&
            -1.20860175D-03 ,     8.58326152D-04 ,     2.14972752D-04,&
            -5.99867373D-04 ,     1.72207569D-04 ,    -9.83031641D-05,&
            -7.33574678D-04 ,    -4.10908135D-04 ,    -7.07565516D-04,&
             1.60530116D-03 ,    -1.56383263D-04 ,    -2.91009696D-04,&
             4.73564251D-05 ,    -1.05978909D-03 ,     9.25246641D-05/
!
!
! . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
!
!     Statement functions for polynomial evaluation:
!
         POLYN1(C0,C1,X) = C0 + C1*X
         POLYN2(C0,C1,C2,X) = C0 + POLYN1(C1,C2,X)*X
         POLYN3(C0,C1,C2,C3,X) = C0 + POLYN2(C1,C2,C3,X)*X
         POLYN4(C0,C1,C2,C3,C4,X) = C0 + POLYN3(C1,C2,C3,C4,X)*X
         POLYN5(C0,C1,C2,C3,C4,C5,X) = C0 + POLYN4(C1,C2,C3,C4,C5,X)*X
         POLYN6(C0,C1,C2,C3,C4,C5,C6,X) = C0 + POLYN5(C1,C2,C3,C4,C5,C6,X)*X
! . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
!
!     Statement Function Definitions:
!
!
!     1) Displacement of hydrogen atom from equilibrium (au).
!
         RE(R) =  R - BLREFR
!
!
!     2) Fractional displacement of hydrogen atom from equilibrium.
!
         FE(R) = RE(R)/BLREFR
!
!
!     3) Difference in cosines between bond angle and equilibrium bond
!     angle.
!
         CE(C) = C - COS(BAREFR)
!
!     4) Compute effective charge using Schwenke & Partridge's (2000)
!        functional form:
!
         Q(R1,R2,C) = &
           EXP(-FCBETA*RE(R1)**2)*(POLYN6(PRM001,PRM002                  &
         ,PRM003,PRM004,PRM005,PRM006,PRM007,FE(R1))                     &
         + EXP(-FCBETA*RE(R2)**2)                                        &
         *(POLYN5(PRM008,PRM009,PRM010,PRM011,PRM012,PRM013,CE(C))*CE(C) &
         +POLYN5(PRM014,PRM015,PRM016,PRM017,PRM018,PRM019,CE(C))*FE(R2) &
         +POLYN4(PRM020,PRM021,PRM022,PRM023,PRM024,CE(C))*FE(R2)**2     &
         +POLYN3(PRM025,PRM026,PRM027,PRM028,CE(C))*FE(R2)**3            &
         +POLYN2(PRM029,PRM030,PRM031,CE(C))*FE(R2)**4                   &
         +POLYN1(PRM032,PRM033,CE(C))*FE(R2)**5                          &
         +PRM034*FE(R2)**6                                               &
         +POLYN4(PRM035,PRM036,PRM037,PRM038,PRM039,CE(C))*CE(C)*FE(R1)  &
         +POLYN4(PRM040,PRM041,PRM042,PRM043,PRM044,CE(C))*FE(R2)*FE(R1) &
         +POLYN3(PRM045,PRM046,PRM047,PRM048,CE(C))*FE(R2)**2*FE(R1)     &
         +POLYN2(PRM049,PRM050,PRM051,CE(C))*FE(R2)**3*FE(R1)            &
         +POLYN1(PRM052,PRM053,CE(C))*FE(R2)**4*FE(R1)                   &
         +PRM054*FE(R2)**5*FE(R1)                                        &
         +POLYN3(PRM055,PRM056,PRM057,PRM058,CE(C))*CE(C)*FE(R1)**2      &
         +POLYN3(PRM059,PRM060,PRM061,PRM062,CE(C))*FE(R2)*FE(R1)**2     &
         +POLYN2(PRM063,PRM064,PRM065,CE(C))*FE(R2)**2*FE(R1)**2         &
         +POLYN1(PRM066,PRM067,CE(C))*FE(R2)**3*FE(R1)**2                &
         +PRM068*FE(R2)**4*FE(R1)**2                                     &
         +POLYN2(PRM069,PRM070,PRM071,CE(C))*CE(C)*FE(R1)**3             &
         +POLYN2(PRM072,PRM073,PRM074,CE(C))*FE(R2)*FE(R1)**3            &
         +POLYN1(PRM075,PRM076,CE(C))*FE(R2)**2*FE(R1)**3                &
         +PRM077*FE(R2)**3*FE(R1)**3                                     &
         +POLYN1(PRM078,PRM079,CE(C))*CE(C)*FE(R1)**4                    &
         +POLYN1(PRM080,PRM081,CE(C))*FE(R2)*FE(R1)**4                   &
         +PRM082*FE(R2)**2*FE(R1)**4                                     &
         +PRM083*CE(C)*FE(R1)**5                                         &
         +PRM084*FE(R2)*FE(R1)**5))
!
! . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
!
!
!     Make copies of parameter values on first call only.
!
         IF (IFIRST.EQ.0) THEN
            PRM001 = FPARAM(01)
            PRM002 = FPARAM(02)
            PRM003 = FPARAM(03)
            PRM004 = FPARAM(04)
            PRM005 = FPARAM(05)
            PRM006 = FPARAM(06)
            PRM007 = FPARAM(07)
            PRM008 = FPARAM(08)
            PRM009 = FPARAM(09)
            PRM010 = FPARAM(10)
            PRM011 = FPARAM(11)
            PRM012 = FPARAM(12)
            PRM013 = FPARAM(13)
            PRM014 = FPARAM(14)
            PRM015 = FPARAM(15)
            PRM016 = FPARAM(16)
            PRM017 = FPARAM(17)
            PRM018 = FPARAM(18)
            PRM019 = FPARAM(19)
            PRM020 = FPARAM(20)
            PRM021 = FPARAM(21)
            PRM022 = FPARAM(22)
            PRM023 = FPARAM(23)
            PRM024 = FPARAM(24)
            PRM025 = FPARAM(25)
            PRM026 = FPARAM(26)
            PRM027 = FPARAM(27)
            PRM028 = FPARAM(28)
            PRM029 = FPARAM(29)
            PRM030 = FPARAM(30)
            PRM031 = FPARAM(31)
            PRM032 = FPARAM(32)
            PRM033 = FPARAM(33)
            PRM034 = FPARAM(34)
            PRM035 = FPARAM(35)
            PRM036 = FPARAM(36)
            PRM037 = FPARAM(37)
            PRM038 = FPARAM(38)
            PRM039 = FPARAM(39)
            PRM040 = FPARAM(40)
            PRM041 = FPARAM(41)
            PRM042 = FPARAM(42)
            PRM043 = FPARAM(43)
            PRM044 = FPARAM(44)
            PRM045 = FPARAM(45)
            PRM046 = FPARAM(46)
            PRM047 = FPARAM(47)
            PRM048 = FPARAM(48)
            PRM049 = FPARAM(49)
            PRM050 = FPARAM(50)
            PRM051 = FPARAM(51)
            PRM052 = FPARAM(52)
            PRM053 = FPARAM(53)
            PRM054 = FPARAM(54)
            PRM055 = FPARAM(55)
            PRM056 = FPARAM(56)
            PRM057 = FPARAM(57)
            PRM058 = FPARAM(58)
            PRM059 = FPARAM(59)
            PRM060 = FPARAM(60)
            PRM061 = FPARAM(61)
            PRM062 = FPARAM(62)
            PRM063 = FPARAM(63)
            PRM064 = FPARAM(64)
            PRM065 = FPARAM(65)
            PRM066 = FPARAM(66)
            PRM067 = FPARAM(67)
            PRM068 = FPARAM(68)
            PRM069 = FPARAM(69)
            PRM070 = FPARAM(70)
            PRM071 = FPARAM(71)
            PRM072 = FPARAM(72)
            PRM073 = FPARAM(73)
            PRM074 = FPARAM(74)
            PRM075 = FPARAM(75)
            PRM076 = FPARAM(76)
            PRM077 = FPARAM(77)
            PRM078 = FPARAM(78)
            PRM079 = FPARAM(79)
            PRM080 = FPARAM(80)
            PRM081 = FPARAM(81)
            PRM082 = FPARAM(82)
            PRM083 = FPARAM(83)
            PRM084 = FPARAM(84)
         ENDIF
!
!
!     Ensure that parameter values are never copied again
!
         IFIRST = 1
!
!
!
!     Evaluate fit functions for current estimate of fit parameters.
!
         DIPZRC  = (Q(R1,R2,COS(THETA))*R1+Q(R2,R1,COS(THETA))*R2)*SQRT((1.0D0+COS(THETA))/2.0D0)
         DIPYRC  = (Q(R1,R2,COS(THETA))*R1-Q(R2,R1,COS(THETA))*R2)*SQRT((1.0D0-COS(THETA))/2.0D0)
!
!
!     End of SUBROUTINE DIPSRC
!
         END

!***********************************************************************
!****     SUBROUTINE DIPSAL  *******************************************
!***********************************************************************
!
!
         SUBROUTINE DIPSAL(DIPYAL,DIPZAL,R1,R2,THETA)
!
!
!     PURPOSE:
!     -------
!     All electron - frozen core corrections are returned for components
!     (for specified water molecule geometries in the Y-Z plane) of the
!     water molecule dipole moment, based on a fit of the Schwenke &
!     Partridge (2000) functional form to ab-intio CCSD(T) calculations
!     by Attila G. Csa'sza'.
!
!
!     NOTES:
!     -----
!     The oxygen atom is considered as fixed at the origin and the H1
!     atom lies in the positive Y-Z quadrant.  The cartesian coordinate
!     system is such that the Z-axis bisects the included bond angle for
!     any geometry.  This subroutine is intended to be called by the
!     DIPS routine in the triatom program suite of Tennyson et al.
!     (1993).
!
!                                ^  Y
!                                l        H1
!                                l
!                                l
!                - - - - - - - - O - - - - - - - - >  Z
!                                l
!                                l
!                                l         H2
!
!
!     REFERENCES:
!     ----------
!     Schwenke D.W. & Partridge H., 2000
!     Tennyson, J., Miller, S. & Le Sueur, C.R., 1993. Comput. Phys.
!       Comm. 75, 339.
!
!
!     DICTIONARY:
!     ----------
!D    A0BOHR              -  Bohr radius in Aangstroms.
!D    BAREFR              -  reference bond angle in radians.
!D    BLREFR              -  reference bond length in atomic units.
!D    DEBYES              -  number of Debyes in an atomic unit.
!D    DIPYAL              -  all-electron correction to dipole moment
!                            component orthogonal to bond bisector.
!D    DIPZAL              -  all-electron correction to dipole moment
!                            component along bond angle bisector.
!D    FCBETA              -  scaling for exponetials used in effective
!                            charge calculation.
!D    FPARAM(MPARAM)      -  fit parameters.
!I    IFIRST              -  flag signally first or later call of this
!                            routine.
!D    PRMnnn              -  parameter values as scalars.
!D    R1                  -  separation of oxygen and H1 atoms in Bohrs.
!D    R2                  -  separation of oxygen and H2 atoms in Bohrs.
!D    THETA               -  bond angle in radians.
!
!
!     DATE AND PROGRAMMER:
!     -------------------
!     A.E. Lynas-Gray                                     2003 March 7th
!
!
!-----------------------------------------------------------------------
!
!     IMPORT:  R1     , R2     , THETA
!     EXPORT:  DIPYAL , DIPZAL
!
!-----------------------------------------------------------------------
!
!
!
         IMPLICIT DOUBLE PRECISION (A-H,O-Z)
!
!
!
         PARAMETER  (A0BOHR = 0.52917706D0)
         PARAMETER  (BAREFR = 104.52D0*3.141592653589793/180.0D0)
         PARAMETER  (BLREFR = 0.957624684D0/A0BOHR)
         PARAMETER  (FCBETA = 3.8D-1*A0BOHR**2)
         PARAMETER  (DEBYES = 2.541747578)
         PARAMETER  (MPARAM = 84)
 
 
         DIMENSION  FPARAM(MPARAM)
 
 
         SAVE  IFIRST
         SAVE  PRM001 , PRM002 , PRM003 , PRM004 , PRM005 , PRM006
         SAVE  PRM007 , PRM008 , PRM009 , PRM010 , PRM011 , PRM012
         SAVE  PRM013 , PRM014 , PRM015 , PRM016 , PRM017 , PRM018
         SAVE  PRM019 , PRM020 , PRM021 , PRM022 , PRM023 , PRM024
         SAVE  PRM025 , PRM026 , PRM027 , PRM028 , PRM029 , PRM030
         SAVE  PRM031 , PRM032 , PRM033 , PRM034 , PRM035 , PRM036
         SAVE  PRM037 , PRM038 , PRM039 , PRM040 , PRM041 , PRM042
         SAVE  PRM043 , PRM044 , PRM045 , PRM046 , PRM047 , PRM048
         SAVE  PRM049 , PRM050 , PRM051 , PRM052 , PRM053 , PRM054
         SAVE  PRM055 , PRM056 , PRM057 , PRM058 , PRM059 , PRM060
         SAVE  PRM061 , PRM062 , PRM063 , PRM064 , PRM065 , PRM066
         SAVE  PRM067 , PRM068 , PRM069 , PRM070 , PRM071 , PRM072
         SAVE  PRM073 , PRM074 , PRM075 , PRM076 , PRM077 , PRM078
         SAVE  PRM079 , PRM080 , PRM081 , PRM082 , PRM083 , PRM084
!
!
         DATA       IFIRST / 0 /
!
!
         DATA (FPARAM(LPARAM),LPARAM=01,MPARAM) / &
               8.87522590E-04 ,     3.81148129E-04 ,    -4.27389808E-04,&
               2.82407535E-04 ,    -2.52298225E-04 ,    -3.49383481E-05,&
               5.62112182E-05 ,    -1.19848824E-04 ,     3.56289493E-05,&
              -2.14018764E-05 ,     1.61927292E-05 ,    -4.33738933E-05,&
              -2.72791985E-05 ,     8.50149663E-05 ,    -8.21477210E-04,&
              -6.41601873E-05 ,     1.83985045E-04 ,     2.07454921E-03,&
              -2.53058551E-03 ,    -1.29338136E-04 ,     2.94008758E-04,&
               6.48329442E-04 ,    -1.86784845E-03 ,     1.32184662E-03,&
               4.18090858E-05 ,     4.03413840E-04 ,    -9.25142376E-04,&
               1.07434392E-03 ,     2.44981093E-05 ,     5.04454947E-04,&
              -2.55092134E-04 ,    -3.62677092E-05 ,    -6.59114856E-04,&
               2.00275736E-05 ,    -1.58656767E-04 ,     7.60086928E-04,&
              -1.17964961E-03 ,    -7.24685611E-04 ,     1.50384998E-03,&
              -3.00624873E-04 ,     4.11824440E-04 ,     1.26975705E-04,&
              -3.73087154E-04 ,     5.21674054E-04 ,    -1.54370384E-04,&
               4.51390981E-04 ,    -1.02113653E-03 ,     3.04104411E-04,&
              -4.70472105E-06 ,    -1.32201370E-04 ,    -2.53027800E-04,&
               1.41822777E-04 ,    -1.31110733E-04 ,     3.89029519E-05,&
              -8.84054054E-04 ,     2.23726631E-04 ,     1.09040184E-06,&
               5.45179530E-04 ,    -3.41888168E-04 ,     8.58629995E-04,&
              -7.66854500E-04 ,    -2.98567174E-04 ,     3.16300575E-05,&
               7.28875020E-05 ,    -2.82031018E-04 ,    -1.26606756E-04,&
               2.30710924E-04 ,    -2.06779689E-04 ,     3.86956846E-04,&
               1.03125686E-03 ,    -9.61888640E-04 ,     9.75772273E-05,&
               5.28461416E-04 ,    -2.76048842E-04 ,     3.86164931E-04,&
               4.46979713E-04 ,     2.93890567E-04 ,     1.32845191E-04,&
              -7.56434340E-04 ,     5.10016049E-04 ,     3.54172080E-04,&
              -1.32894056E-04 ,     7.84503180E-04 ,     1.21441757E-04/
!
!
! . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
!
!     Statement functions for polynomial evaluation:
!
         POLYN1(C0,C1,X) = C0 + C1*X
         POLYN2(C0,C1,C2,X) = C0 + POLYN1(C1,C2,X)*X
         POLYN3(C0,C1,C2,C3,X) = C0 + POLYN2(C1,C2,C3,X)*X
         POLYN4(C0,C1,C2,C3,C4,X) = C0 + POLYN3(C1,C2,C3,C4,X)*X
         POLYN5(C0,C1,C2,C3,C4,C5,X) = C0 + POLYN4(C1,C2,C3,C4,C5,X)*X
         POLYN6(C0,C1,C2,C3,C4,C5,C6,X) = C0 + POLYN5(C1,C2,C3,C4,C5,C6,X)*X
! . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
!
!     Statement Function Definitions:
!
!
!     1) Displacement of hydrogen atom from equilibrium (au).
!
         RE(R) =  R - BLREFR
!
!
!     2) Fractional displacement of hydrogen atom from equilibrium.
!
         FE(R) = RE(R)/BLREFR
!
!
!     3) Difference in cosines between bond angle and equilibrium bond
!     angle.
!
         CE(C) = C - COS(BAREFR)
!
!     4) Compute effective charge using Schwenke & Partridge's (2000)
!        functional form:
!
         Q(R1,R2,C) = &
          EXP(-FCBETA*RE(R1)**2)*(POLYN6(PRM001,PRM002                  &
         ,PRM003,PRM004,PRM005,PRM006,PRM007,FE(R1))                     &
         + EXP(-FCBETA*RE(R2)**2)                                        &
         *(POLYN5(PRM008,PRM009,PRM010,PRM011,PRM012,PRM013,CE(C))*CE(C) &
         +POLYN5(PRM014,PRM015,PRM016,PRM017,PRM018,PRM019,CE(C))*FE(R2) &
         +POLYN4(PRM020,PRM021,PRM022,PRM023,PRM024,CE(C))*FE(R2)**2     &
         +POLYN3(PRM025,PRM026,PRM027,PRM028,CE(C))*FE(R2)**3            &
         +POLYN2(PRM029,PRM030,PRM031,CE(C))*FE(R2)**4                   &
         +POLYN1(PRM032,PRM033,CE(C))*FE(R2)**5                          &
         +PRM034*FE(R2)**6                                               &
         +POLYN4(PRM035,PRM036,PRM037,PRM038,PRM039,CE(C))*CE(C)*FE(R1)  &
         +POLYN4(PRM040,PRM041,PRM042,PRM043,PRM044,CE(C))*FE(R2)*FE(R1) &
         +POLYN3(PRM045,PRM046,PRM047,PRM048,CE(C))*FE(R2)**2*FE(R1)     &
         +POLYN2(PRM049,PRM050,PRM051,CE(C))*FE(R2)**3*FE(R1)            &
         +POLYN1(PRM052,PRM053,CE(C))*FE(R2)**4*FE(R1)                   &
         +PRM054*FE(R2)**5*FE(R1)                                        &
         +POLYN3(PRM055,PRM056,PRM057,PRM058,CE(C))*CE(C)*FE(R1)**2      &
         +POLYN3(PRM059,PRM060,PRM061,PRM062,CE(C))*FE(R2)*FE(R1)**2     &
         +POLYN2(PRM063,PRM064,PRM065,CE(C))*FE(R2)**2*FE(R1)**2         &
         +POLYN1(PRM066,PRM067,CE(C))*FE(R2)**3*FE(R1)**2                &
         +PRM068*FE(R2)**4*FE(R1)**2                                     &
         +POLYN2(PRM069,PRM070,PRM071,CE(C))*CE(C)*FE(R1)**3             &
         +POLYN2(PRM072,PRM073,PRM074,CE(C))*FE(R2)*FE(R1)**3            &
         +POLYN1(PRM075,PRM076,CE(C))*FE(R2)**2*FE(R1)**3                &
         +PRM077*FE(R2)**3*FE(R1)**3                                     &
         +POLYN1(PRM078,PRM079,CE(C))*CE(C)*FE(R1)**4                    &
         +POLYN1(PRM080,PRM081,CE(C))*FE(R2)*FE(R1)**4                   &
         +PRM082*FE(R2)**2*FE(R1)**4                                     &
         +PRM083*CE(C)*FE(R1)**5                                         &
         +PRM084*FE(R2)*FE(R1)**5))                                      
!
! . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
!
!
!     Make copies of parameter values on first call only.
!
         IF (IFIRST.EQ.0) THEN
            PRM001 = FPARAM(01)
            PRM002 = FPARAM(02)
            PRM003 = FPARAM(03)
            PRM004 = FPARAM(04)
            PRM005 = FPARAM(05)
            PRM006 = FPARAM(06)
            PRM007 = FPARAM(07)
            PRM008 = FPARAM(08)
            PRM009 = FPARAM(09)
            PRM010 = FPARAM(10)
            PRM011 = FPARAM(11)
            PRM012 = FPARAM(12)
            PRM013 = FPARAM(13)
            PRM014 = FPARAM(14)
            PRM015 = FPARAM(15)
            PRM016 = FPARAM(16)
            PRM017 = FPARAM(17)
            PRM018 = FPARAM(18)
            PRM019 = FPARAM(19)
            PRM020 = FPARAM(20)
            PRM021 = FPARAM(21)
            PRM022 = FPARAM(22)
            PRM023 = FPARAM(23)
            PRM024 = FPARAM(24)
            PRM025 = FPARAM(25)
            PRM026 = FPARAM(26)
            PRM027 = FPARAM(27)
            PRM028 = FPARAM(28)
            PRM029 = FPARAM(29)
            PRM030 = FPARAM(30)
            PRM031 = FPARAM(31)
            PRM032 = FPARAM(32)
            PRM033 = FPARAM(33)
            PRM034 = FPARAM(34)
            PRM035 = FPARAM(35)
            PRM036 = FPARAM(36)
            PRM037 = FPARAM(37)
            PRM038 = FPARAM(38)
            PRM039 = FPARAM(39)
            PRM040 = FPARAM(40)
            PRM041 = FPARAM(41)
            PRM042 = FPARAM(42)
            PRM043 = FPARAM(43)
            PRM044 = FPARAM(44)
            PRM045 = FPARAM(45)
            PRM046 = FPARAM(46)
            PRM047 = FPARAM(47)
            PRM048 = FPARAM(48)
            PRM049 = FPARAM(49)
            PRM050 = FPARAM(50)
            PRM051 = FPARAM(51)
            PRM052 = FPARAM(52)
            PRM053 = FPARAM(53)
            PRM054 = FPARAM(54)
            PRM055 = FPARAM(55)
            PRM056 = FPARAM(56)
            PRM057 = FPARAM(57)
            PRM058 = FPARAM(58)
            PRM059 = FPARAM(59)
            PRM060 = FPARAM(60)
            PRM061 = FPARAM(61)
            PRM062 = FPARAM(62)
            PRM063 = FPARAM(63)
            PRM064 = FPARAM(64)
            PRM065 = FPARAM(65)
            PRM066 = FPARAM(66)
            PRM067 = FPARAM(67)
            PRM068 = FPARAM(68)
            PRM069 = FPARAM(69)
            PRM070 = FPARAM(70)
            PRM071 = FPARAM(71)
            PRM072 = FPARAM(72)
            PRM073 = FPARAM(73)
            PRM074 = FPARAM(74)
            PRM075 = FPARAM(75)
            PRM076 = FPARAM(76)
            PRM077 = FPARAM(77)
            PRM078 = FPARAM(78)
            PRM079 = FPARAM(79)
            PRM080 = FPARAM(80)
            PRM081 = FPARAM(81)
            PRM082 = FPARAM(82)
            PRM083 = FPARAM(83)
            PRM084 = FPARAM(84)
         ENDIF
!
!
!     Ensure that parameter values are never copied again
!
         IFIRST = 1
!
!
!
!     Evaluate fit functions for current estimate of fit parameters.
!
         DIPZAL  = (Q(R1,R2,COS(THETA))*R1+Q(R2,R1,COS(THETA))*R2)*SQRT((1.0D0+COS(THETA))/2.0D0)
         DIPYAL  = (Q(R1,R2,COS(THETA))*R1-Q(R2,R1,COS(THETA))*R2)*SQRT((1.0D0-COS(THETA))/2.0D0)
!
!
!     End of SUBROUTINE DIPSAL
!
         END subroutine
